import{_ as Y,u as _e,a as ve,c as X,o as ee,w as A,b as i,d as o,e,f as T,g as ne,t as p,h as r,i as C,j as fe,k as n,l as S,S as ye,N as R,F as U,r as K,M as ge,A as ue,B as te,m as k,n as pe,C as oe,p as he,q as be,s as $e,v as we,x as se,y as ke,z as me,D as Ie,E as xe,G as Ce,H as le,I as ie,J as Z,K as re,L as Se,O as z,P as J,Q as Ne,R as Te,T as je,U as Ve,V as Fe,W as Le,X as De,Y as Pe,Z as Re,$ as Ee,a0 as Oe,a1 as ze,a2 as Q,a3 as Ue,a4 as Be,a5 as qe,a6 as Me,a7 as Ae,a8 as ce,a9 as de,aa as W,ab as Ke,ac as Ge,ad as He,ae as Ze,af as Je,ag as Qe}from"./index-BppwuCGU.js";const We={class:"step-intro"},Xe={class:"intro-content"},Ye={class:"template-info"},et={class:"template-header"},tt={class:"template-name"},st={class:"template-description"},at={key:0,class:"template-stats"},nt={class:"stat-item"},ot={key:1,class:"template-languages"},lt={class:"languages-list"},it={key:2,class:"template-introduction"},rt={class:"markdown-content"},ct={class:"step-actions"},dt={__name:"StepIntro",props:{templateInfo:{type:Object,default:null}},emits:["next"],setup(I){const F=I,m=_e(),h=ve();X(()=>F.templateInfo?.categoryId?h.categoriesList.find(f=>f.id===F.templateInfo.categoryId):null);const u=f=>(h.categoriesList.find(c=>c.id===f),"success"),_=f=>{const c=h.categoriesList.find(g=>g.id===f);return c?c.name:"未知分类"},v=X(()=>F.templateInfo?.languages?.length?F.templateInfo.languages.map(c=>{const g=m.languagesList.find(j=>j.id===c.languageId);return{...c,name:g?.name||"未知语言",displayName:g?.displayName||g?.name||"未知语言",color:g?.color||"#18a058"}}):[]);return ee(async()=>{try{await Promise.all([m.getLanguages(),h.getCategories()])}catch(f){console.error("加载语言或分类数据失败:",f)}}),A(()=>F.templateInfo,f=>{},{immediate:!0,deep:!0}),(f,c)=>{const g=fe,j=R,N=te;return o(),i("div",We,[e("div",Xe,[e("div",Ye,[e("div",et,[e("h1",tt,p(I.templateInfo?.name),1),I.templateInfo?.categoryId?(o(),ne(g,{key:0,type:u(I.templateInfo?.categoryId),size:"large"},{default:r(()=>[C(p(_(I.templateInfo?.categoryId)),1)]),_:1},8,["type"])):T("",!0)]),e("div",st,p(I.templateInfo?.description),1),I.templateInfo?.isFeatured?(o(),i("div",at,[e("div",nt,[n(j,{size:"20",color:"#f0a020"},{default:r(()=>[n(S(ye))]),_:1}),c[1]||(c[1]=e("span",null,"推荐模板",-1))])])):T("",!0),v.value.length>0?(o(),i("div",ot,[c[2]||(c[2]=e("h3",{class:"languages-title"},"支持的语言",-1)),e("div",lt,[(o(!0),i(U,null,K(v.value,V=>(o(),ne(g,{key:V.id,color:{color:V.isPrimary===1?"#e8f5e8":V.color},size:"large",style:{"margin-right":"12px","margin-bottom":"8px"}},{default:r(()=>[C(p(V.displayName)+" ",1),V.isPrimary===1?(o(),i(U,{key:0},[C(" (主语言) ")],64)):T("",!0)]),_:2},1032,["color"]))),128))])])):T("",!0),I.templateInfo?.introduction?(o(),i("div",it,[c[3]||(c[3]=e("h3",{class:"intro-title"},"详细介绍",-1)),e("div",rt,[n(S(ge),{modelValue:I.templateInfo.introduction},null,8,["modelValue"])])])):T("",!0)])]),e("div",ct,[n(N,{type:"primary",size:"large",onClick:c[0]||(c[0]=V=>f.$emit("next")),disabled:!I.templateInfo},{icon:r(()=>[n(j,null,{default:r(()=>[n(S(ue))]),_:1})]),default:r(()=>[c[4]||(c[4]=C(" 开始配置 "))]),_:1,__:[4]},8,["disabled"])])])}}},ut=Y(dt,[["__scopeId","data-v-145a618b"]]),pt={class:"step-variables"},mt={class:"variables-content"},_t={key:0,class:"loading-container"},vt={key:1,class:"variables-form"},ft={key:0,class:"variable-section"},yt={class:"section-title"},gt={class:"section-subtitle"},ht={class:"variable-grid"},bt={key:0,class:"required-mark"},$t={class:"variable-desc"},wt={key:1,class:"variable-section"},kt={class:"section-title"},It={class:"section-subtitle"},xt={class:"variable-grid"},Ct={class:"usage-count"},St={class:"variable-desc"},Nt={key:0,class:"usage-files"},Tt={key:2,class:"variable-section"},jt={class:"collapse-header"},Vt={class:"section-subtitle"},Ft={class:"function-list"},Lt={class:"function-info"},Dt={class:"function-name"},Pt={class:"usage-count"},Rt={class:"function-desc"},Et={key:0,class:"usage-files"},Ot={class:"step-actions"},zt={__name:"StepVariables",props:{templateInfo:{type:Object,default:null},variables:{type:Object,default:()=>({})}},emits:["prev","next","update-variables"],setup(I,{emit:F}){const m=I,h=F,u=k({}),_=k([]),v=k([]),f=k([]),c=k(null),g=k(!1),j=()=>{const a={};return _.value.forEach(s=>{if(s.isRequired&&(a[s.name]={required:!0,message:`${s.description||s.name}不能为空`},s.validationRegex))try{a[s.name].pattern=new RegExp(s.validationRegex),a[s.name].message=`${s.description||s.name}格式不正确`}catch{console.warn("无效的验证正则表达式:",s.validationRegex)}}),a},N=a=>{const b=j()[a];if(!b)return;const $=u.value[a];if(b.required&&!$||b.pattern&&$&&!b.pattern.test($))return"error"},V=X(()=>{const a=j();for(const[s,b]of Object.entries(a)){const $=u.value[s];if(b.required&&!$||b.pattern&&$&&!b.pattern.test($))return!1}return!0}),B=a=>{switch(a){case"email":return"email";case"number":return"number";case"textarea":return"textarea";case"password":return"password";default:return"text"}},x=async()=>{if(m.templateInfo?.id){g.value=!0;try{const a=await ke(m.templateInfo.id);if(a.data&&a.data.data){_.value=a.data.data.customVariables||[],v.value=a.data.data.builtinVariables||[],f.value=a.data.data.templateFunctions||[],c.value=a.data.data.statistics;const s={...u.value};v.value.forEach(b=>{const $=b.name.toLowerCase();s[$]||(s[$]="")}),_.value.forEach(b=>{s[b.name]||(s[b.name]=b.defaultValue||"")}),u.value=s}}catch(a){console.error("加载模板变量失败:",a)}finally{g.value=!1}}};let L=null;A(u,a=>{L&&clearTimeout(L),L=setTimeout(()=>{h("update-variables",a)},100)},{deep:!0});let E=!1;A(()=>m.variables,a=>{!E&&a&&Object.keys(a).length>0&&(u.value={...u.value,...a},E=!0)},{immediate:!0});let D=null;A(()=>m.templateInfo,a=>{a?.id&&a.id!==D&&(D=a.id,setTimeout(()=>{x()},100))},{immediate:!1}),ee(()=>{m.templateInfo?.id&&(D=m.templateInfo.id,setTimeout(()=>{x()},100))});const q=()=>{V.value&&(h("update-variables",u.value),h("next"))};return(a,s)=>{const b=pe,$=R,G=he,d=$e,l=we,w=te;return o(),i("div",pt,[e("div",mt,[g.value?(o(),i("div",_t,[n(b,{size:"large"},{description:r(()=>s[1]||(s[1]=[C(" 正在加载模板变量信息... ")])),_:1})])):(o(),i("div",vt,[s[5]||(s[5]=e("h2",{class:"form-title"},"配置项目变量",-1)),s[6]||(s[6]=e("p",{class:"form-desc"},"请填写以下信息来配置您的项目",-1)),_.value.length>0?(o(),i("div",ft,[e("h3",yt,[n($,null,{default:r(()=>[n(S(oe))]),_:1}),s[2]||(s[2]=C(" 自定义变量 ")),e("span",gt,"("+p(c.value?.totalCustomVariables||0)+" 个变量)",1)]),e("div",ht,[(o(!0),i(U,null,K(_.value,t=>(o(),i("div",{key:t.name,class:"variable-item"},[e("label",null,[C(p(t.description||t.name)+" ",1),t.isRequired?(o(),i("span",bt,"*")):T("",!0)]),n(G,{value:u.value[t.name],"onUpdate:value":y=>u.value[t.name]=y,placeholder:t.description||"请输入值",status:N(t.name),type:B(t.variableType)},null,8,["value","onUpdate:value","placeholder","status","type"]),e("div",$t,p(t.description),1)]))),128))])])):T("",!0),v.value.length>0?(o(),i("div",wt,[e("h3",kt,[n($,null,{default:r(()=>[n(S(be))]),_:1}),s[3]||(s[3]=C(" 内置变量 ")),e("span",It,"("+p(c.value?.totalBuiltinVariables||0)+" 个变量)",1)]),e("div",xt,[(o(!0),i(U,null,K(v.value,t=>(o(),i("div",{key:t.name,class:"variable-item builtin-variable"},[e("label",null,[C(p(t.label)+" ",1),e("span",Ct,"(使用 "+p(t.usageCount)+" 次)",1)]),n(G,{value:u.value[t.name.toLowerCase()],"onUpdate:value":y=>u.value[t.name.toLowerCase()]=y,placeholder:t.description},null,8,["value","onUpdate:value","placeholder"]),e("div",St,[C(p(t.description)+" ",1),t.files.length>0?(o(),i("div",Nt," 使用文件: "+p(t.files.join(", ")),1)):T("",!0)])]))),128))])])):T("",!0),f.value.length>0?(o(),i("div",Tt,[n(l,null,{default:r(()=>[n(d,{title:"模板函数信息",name:"functions"},{header:r(()=>[e("div",jt,[n($,null,{default:r(()=>[n(S(oe))]),_:1}),s[4]||(s[4]=e("span",null,"模板函数",-1)),e("span",Vt,"("+p(c.value?.totalFunctions||0)+" 个函数)",1)])]),default:r(()=>[e("div",Ft,[(o(!0),i(U,null,K(f.value,t=>(o(),i("div",{key:t.name,class:"function-item"},[e("div",Lt,[e("span",Dt,p(t.label),1),e("span",Pt,"(使用 "+p(t.usageCount)+" 次)",1)]),e("div",Rt,p(t.description),1),t.files.length>0?(o(),i("div",Et," 使用文件: "+p(t.files.join(", ")),1)):T("",!0)]))),128))])]),_:1})]),_:1})])):T("",!0)]))]),e("div",Ot,[n(w,{onClick:s[0]||(s[0]=t=>a.$emit("prev"))},{icon:r(()=>[n($,null,{default:r(()=>[n(S(se))]),_:1})]),default:r(()=>[s[7]||(s[7]=C(" 上一步 "))]),_:1,__:[7]}),n(w,{type:"primary",onClick:q,disabled:!V.value},{icon:r(()=>[n($,null,{default:r(()=>[n(S(ue))]),_:1})]),default:r(()=>[s[8]||(s[8]=C(" 下一步 "))]),_:1,__:[8]},8,["disabled"])])])}}},Ut=Y(zt,[["__scopeId","data-v-7648ab00"]]),Bt={class:"preview-fullscreen"},qt={class:"preview-header"},Mt={class:"header-left"},At={class:"template-name"},Kt={class:"header-actions"},Gt={class:"preview-main"},Ht={class:"file-explorer"},Zt={class:"explorer-content"},Jt={key:0,class:"loading-container"},Qt={key:1,class:"empty-container"},Wt={key:2,class:"file-tree"},Xt={class:"preview-container"},Yt={class:"preview-content"},es={key:0,class:"no-file-selected"},ts={class:"no-file-icon"},ss={key:1,class:"file-preview"},as={class:"file-header"},ns={class:"file-info"},os={class:"file-name"},ls={class:"file-content"},is={class:"code-preview"},rs={__name:"StepPreview",props:{templateInfo:{type:Object,default:null},variables:{type:Object,default:()=>({})}},emits:["prev","next"],setup(I,{emit:F}){const m=I,h=me(),u=k([]),_=k(!1),v=k(""),f=k(""),c=k(""),g=k(new Map),j=k(null);let N=null;const V={js:z(),javascript:z(),ts:z({typescript:!0}),typescript:z({typescript:!0}),jsx:z({jsx:!0}),tsx:z({typescript:!0,jsx:!0}),vue:Se(),html:re(),htm:re(),css:Z(),scss:Z(),sass:Z(),less:Z(),json:Ge(),md:ie(),markdown:ie(),py:le(),python:le(),java:Ke(),cpp:W(),cc:W(),cxx:W(),c:W(),rs:de(),rust:de(),go:Ce(),sql:xe(),xml:Ie(),yaml:ce(),yml:ce()};function B(d){const l=d.split(".").pop()?.toLowerCase();return V[l]||null}const x=k(new Set),L=X(()=>E(u.value));function E(d){if(!Array.isArray(d))return[];const l=(t,y)=>{if((y.isDirectory||0)-(t.isDirectory||0)!==0)return(y.isDirectory||0)-(t.isDirectory||0);const P=(t.fileName||t.label||"").toLowerCase(),H=(y.fileName||y.label||"").toLowerCase();return P.localeCompare(H)};return[...d].sort(l).map(t=>{const y=t.key||t.id,P=x.value.has(String(y));return{label:(O=>O.fileName||O.name||"")(t),key:y,isLeaf:t.isDirectory!==1,filePath:t.filePath,fileName:t.fileName,prefix:()=>J(R,null,{default:()=>J(t.isDirectory===1?P?Ne:Te:je)}),children:t.children?E(t.children):[]}})}const D=async()=>{if(!m.templateInfo?.id){console.log("templateInfo.id 不存在，跳过加载");return}_.value=!0;try{const l=(await Pe({templateId:m.templateInfo.id,variables:m.variables||{}})).data?.data?.tree||[];u.value=l,g.value.clear();const w=t=>{t.forEach(y=>{g.value.set(y.id,y),y.children&&y.children.length>0&&w(y.children)})};w(l)}catch(d){console.error("加载文件树失败:",d),u.value=[]}finally{_.value=!1}},q=async d=>{if(!d||d.length===0)return;const l=d[0],w=(H,O)=>{for(const M of H){if(M.key===O||M.id===O)return M;if(M.children){const ae=w(M.children,O);if(ae)return ae}}return null},t=w(u.value,l);if(!t||t.isDirectory===1)return;const y=t.id||l,P=g.value.get(y);P?(v.value=P.fileName,f.value=P.filePath,c.value=P.fileContent,await Ee(),a()):(console.error("未找到渲染后的文件:",y),c.value="文件未找到")},a=async()=>{if(!j.value)return;N&&(N.destroy(),N=null);const d=v.value?B(v.value):null,l=[ze,Q.editable.of(!1),Ue(),Be(),qe(Me),Q.scrollMargins.of(()=>({top:10,bottom:10})),Q.theme({"&":{height:"100%"},".cm-scroller":{overflow:"auto !important",height:"100% !important"}})];d&&l.push(d);const w=Ae.create({doc:c.value,extensions:l});N=new Q({state:w,parent:j.value}),setTimeout(()=>{N&&N.scrollDOM&&N.requestMeasure()},100)},s=d=>{x.value=new Set(d)},b=({option:d})=>d.label,$=()=>J(R,null,{default:()=>J(Oe)}),G=async()=>{try{h.loading("正在生成项目...",{duration:0});const d=await Re({templateId:m.templateInfo.id,variables:m.variables||{},fileName:m.templateInfo.name}),l=new Blob([d.data],{type:"application/zip"}),w=window.URL.createObjectURL(l),t=document.createElement("a");t.href=w,t.download=`${m.templateInfo.name}.zip`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(w),h.destroyAll(),h.success("项目生成成功！")}catch(d){h.destroyAll(),console.error("生成项目失败:",d),h.error("生成项目失败，请重试")}};return A(()=>m.templateInfo,d=>{d?.id&&setTimeout(()=>{D()},100)},{immediate:!1}),ee(()=>{m.templateInfo?.id&&(console.log("StepPreview 组件挂载时直接加载文件树"),D())}),Ve(()=>{N&&N.destroy()}),(d,l)=>{const w=te,t=pe;return o(),i("div",Bt,[e("div",qt,[e("div",Mt,[l[1]||(l[1]=e("span",{class:"preview-title"},"预览确认",-1)),e("span",At,p(I.templateInfo?.name),1)]),e("div",Kt,[n(w,{size:"small",onClick:l[0]||(l[0]=y=>d.$emit("prev"))},{icon:r(()=>[n(S(R),null,{default:r(()=>[n(S(se))]),_:1})]),default:r(()=>[l[2]||(l[2]=C(" 返回配置 "))]),_:1,__:[2]}),n(w,{type:"primary",size:"small",onClick:G},{icon:r(()=>[n(S(R),null,{default:r(()=>[n(S(Fe))]),_:1})]),default:r(()=>[l[3]||(l[3]=C(" 生成项目 "))]),_:1,__:[3]})])]),e("div",Gt,[e("div",Ht,[l[6]||(l[6]=e("div",{class:"explorer-header"},[e("span",{class:"explorer-title"},"模板文件")],-1)),e("div",Zt,[_.value?(o(),i("div",Jt,[n(t,{size:"small"},{description:r(()=>l[4]||(l[4]=[C(" 加载中... ")])),_:1})])):u.value.length===0?(o(),i("div",Qt,l[5]||(l[5]=[e("div",{class:"empty-text"},"暂无文件",-1)]))):(o(),i("div",Wt,[n(S(Le),{data:L.value,"selected-keys":[v.value],"render-label":b,"render-switcher-icon":$,"onUpdate:selectedKeys":q,"onUpdate:expandedKeys":s},null,8,["data","selected-keys"])]))])]),e("div",Xt,[e("div",Yt,[v.value?(o(),i("div",ss,[e("div",as,[e("div",ns,[e("span",os,p(v.value),1)])]),e("div",ls,[e("div",is,[e("div",{class:"codemirror-container",ref_key:"codeContainer",ref:j},null,512)])])])):(o(),i("div",es,[e("div",ts,[n(S(R),{size:"48",color:"#ccc"},{default:r(()=>[n(S(De))]),_:1})]),l[7]||(l[7]=e("div",{class:"no-file-text"},"请选择左侧文件进行预览",-1))]))])])])])}}},cs=Y(rs,[["__scopeId","data-v-bab832ae"]]),ds={class:"template-generator"},us={class:"generator-header"},ps={class:"header-left"},ms={class:"template-title"},_s={key:0,class:"template-name"},vs={class:"step-indicator"},fs={class:"step-number"},ys={class:"step-label"},gs={class:"generator-content"},hs={key:0,class:"step-content"},bs={key:1,class:"step-content"},$s={key:2,class:"step-content"},ws={__name:"TemplateGenerator",setup(I){const F=Je(),m=Qe(),h=me(),u=[{label:"模板介绍",key:"intro"},{label:"配置变量",key:"variables"},{label:"预览确认",key:"preview"}],_=k(1),v=k(null),f=k({}),c=async()=>{try{const x=await Ze({id:F.params.id});v.value=x.data.data.data}catch(x){h.error("加载模板信息失败"),console.error(x)}},g=()=>{_.value<3&&_.value++},j=()=>{_.value>1&&_.value--},N=x=>{f.value={...x}},V=async()=>{try{h.loading("正在生成项目..."),await new Promise(x=>setTimeout(x,2e3)),h.success("项目生成成功！")}catch(x){h.error("生成失败："+x.message)}},B=()=>{m.back()};return ee(async()=>{await c()}),(x,L)=>{const E=R,D=te;return o(),i("div",ds,[e("div",us,[e("div",ps,[n(D,{text:"",onClick:B},{icon:r(()=>[n(E,null,{default:r(()=>[n(S(se))]),_:1})]),default:r(()=>[L[0]||(L[0]=C(" 返回 "))]),_:1,__:[0]}),e("div",ms,[L[1]||(L[1]=e("span",{class:"title-text"},"使用模板",-1)),v.value?(o(),i("span",_s,p(v.value.name),1)):T("",!0)])]),e("div",vs,[(o(),i(U,null,K(u,(q,a)=>e("div",{key:a,class:He(["step-item",{active:_.value===a+1,completed:_.value>a+1}])},[e("div",fs,p(a+1),1),e("div",ys,p(q.label),1)],2)),64))])]),e("div",gs,[_.value===1?(o(),i("div",hs,[n(ut,{"template-info":v.value,onNext:g},null,8,["template-info"])])):T("",!0),_.value===2?(o(),i("div",bs,[n(Ut,{"template-info":v.value,variables:f.value,onPrev:j,onNext:g,onUpdateVariables:N},null,8,["template-info","variables"])])):T("",!0),_.value===3?(o(),i("div",$s,[n(cs,{"template-info":v.value,variables:f.value,onPrev:j,onGenerate:V},null,8,["template-info","variables"])])):T("",!0)])])}}},Is=Y(ws,[["__scopeId","data-v-e2501dfe"]]);export{Is as default};
